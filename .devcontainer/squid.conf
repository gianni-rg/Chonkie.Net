# Squid Proxy Configuration for Dev Container Network Filtering
# This configuration allows only whitelisted domains for security

# Basic proxy settings
http_port 3128

# Access control - deny all by default
acl localnet src 172.16.0.0/12  # Docker network range
acl allowed_domains dstdomain "/etc/squid/allowed-domains.txt"

# SSL bump configuration (optional - for HTTPS inspection)
# Uncomment if you need to inspect HTTPS traffic
# http_port 3128 ssl-bump cert=/etc/squid/ssl/cert.pem key=/etc/squid/ssl/key.pem
# acl step1 at_step SslBump1
# ssl_bump peek step1
# ssl_bump splice all

# Access rules
http_access allow localnet allowed_domains
http_access deny all

# Logging
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log
cache_store_log /var/log/squid/store.log

# Cache settings (optional)
cache_dir ufs /var/spool/squid 1000 16 256
maximum_object_size 50 MB
cache_mem 256 MB

# DNS settings
dns_nameservers 8.8.8.8 1.1.1.1

# Performance tuning
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

# Anonymization (optional - hide client info)
forwarded_for delete
request_header_access X-Forwarded-For deny all
request_header_access Via deny all
request_header_access Cache-Control deny all

# Error page customization
error_directory /usr/share/squid/errors/en

# Coredump directory
coredump_dir /var/spool/squid
